(function(b){b.ketchup={defaults:{attribute:"data-validate",validateIndicator:"validate",eventIndicator:"on",validateEvents:"blur",validateElements:["input","textarea","select"],createErrorContainer:null,showErrorContainer:null,hideErrorContainer:null,addErrorMessages:null},dataNames:{validationString:"ketchup-validation-string",validations:"ketchup-validations",events:"ketchup-events",elements:"ketchup-validation-elements",container:"ketchup-container"},validations:{},helpers:{},validation:function(){var g,d,c=arguments[1];
if(typeof c=="function"){d=c;}else{g=c;d=arguments[2];}this.validations[arguments[0]]={message:g,func:d,init:arguments[3]||function(j,h){}};return this;
},message:function(c,d){this.addMessage(c,d);return this;},messages:function(c){for(name in c){this.addMessage(name,c[name]);}return this;},addMessage:function(c,d){if(this.validations[c]){this.validations[c].message=d;
}},helper:function(c,d){this.helpers[c]=d;return this;},init:function(h,g,c){this.options=g;var d=this,j=this.initFunctions().initFields(h,c);j.each(function(){var k=b(this);
d.bindValidationEvent(h,k).callInitFunctions(h,k);});h.data(this.dataNames.elements,j);this.bindFormSubmit(h);},initFunctions:function(){var d=this.options,c=["createErrorContainer","showErrorContainer","hideErrorContainer","addErrorMessages"];
for(f=0;f<c.length;f++){var g=c[f];if(!d[g]){d[g]=this[g];}}return this;},initFields:function(g,c){var d=this,h=this.dataNames,j=b(!c?this.fieldsFromForm(g):this.fieldsFromObject(g,c));
j.each(function(){var k=b(this),l=d.extractValidations(k.data(h.validationString),d.options.validateIndicator);k.data(h.validations,l);});return j;},callInitFunctions:function(d,c){var g=c.data(this.dataNames.validations);
for(i=0;i<g.length;i++){g[i].init.apply(this.helpers,[d,c]);}},fieldsFromForm:function(h){var c=this,g=this.options,j=this.dataNames,l=g.validateElements,k=[];
l=typeof l=="string"?[l]:l;for(i=0;i<l.length;i++){var d=h.find(l[i]+"["+g.attribute+"*="+g.validateIndicator+"]");d.each(function(){var q=b(this),m=q.attr(g.attribute),p=c.extractEvents(m,g.eventIndicator);
q.data(j.validationString,m).data(j.events,p?p:g.validateEvents);});k.push(d.get());}return this.normalizeArray(k);},fieldsFromObject:function(j,c){var h=this.options,k=this.dataNames,m=[];
for(s in c){var d,g;if(typeof c[s]=="string"){d=c[s];g=h.validateEvents;}else{d=c[s][0];g=c[s][1];}var l=j.find(s);d=this.mergeValidationString(l,d);g=this.mergeEventsString(l,g);
l.data(k.validationString,h.validateIndicator+"("+d+")").data(k.events,g);m.push(l.get());}return this.normalizeArray(m);},mergeEventsString:function(j,d){var c=j.data(this.dataNames.events),h="";
if(c){var g=c.split(" ");for(i=0;i<g.length;i++){if(d.indexOf(g[i])==-1){h+=" "+g[i];}}}return b.trim(d+h);},mergeValidationString:function(m,l){var h=this.options,d=m.data(this.dataNames.validationString),g=function(p){var q=p.name;
if(p.arguments.length){q=q+"("+p.arguments.join(",")+")";}return q;},c=function(p,q){for(i=0;i<p.length;i++){if(p[i].name==q.name){return true;}}};if(d){var j=this.extractValidations(h.validateIndicator+"("+l+")",h.validateIndicator),k=this.extractValidations(d,h.validateIndicator);
l="";for(o=0;o<k.length;o++){l+=g(k[o])+",";}for(n=0;n<j.length;n++){if(!c(k,j[n])){l+=g(j[n])+",";}}}return l;},bindFormSubmit:function(g){var c=this,d=this.options;
g.submit(function(){return c.allFieldsValid(g,true);});},allFieldsValid:function(g,h){var d=this,c=true;g.data(this.dataNames.elements).each(function(){var j=b(this);
if(d.validateElement(j,g)!=true){if(h==true){d.triggerValidationEvents(j);}c=false;}});g.trigger("formIs"+(c?"Valid":"Invalid"),[g]);return c;},bindValidationEvent:function(j,h){var c=this,g=this.options,k=this.dataNames,d=h.data(k.events).split(" ");
for(i=0;i<d.length;i++){h.bind("ketchup."+d[i],function(){var l=c.validateElement(h,j),m=h.data(k.container);if(l!=true){if(!m){m=g.createErrorContainer(j,h);
h.data(k.container,m);}g.addErrorMessages(j,h,m,l);g.showErrorContainer(j,h,m);}else{if(m){g.hideErrorContainer(j,h,m);}}});this.bindValidationEventBridge(h,d[i]);
}return this;},bindValidationEventBridge:function(c,d){c.bind(d,function(){c.trigger("ketchup."+d);});},validateElement:function(g,h){var c=[],j=g.data(this.dataNames.validations),d=[h,g,g.val()];
for(i=0;i<j.length;i++){if(!j[i].func.apply(this.helpers,d.concat(j[i].arguments))){c.push(j[i].message);}}h.trigger("fieldIs"+(c.length?"Invalid":"Valid"),[h,g]);
return c.length?c:true;},elementIsValid:function(c){var g=this.dataNames;if(c.data(g.validations)){var d=c.parentsUntil("form").last().parent();return(this.validateElement(c,d)==true?true:false);
}else{if(c.data(g.elements)){return this.allFieldsValid(c);}}return null;},triggerValidationEvents:function(d){var c=d.data(this.dataNames.events).split(" ");
for(var g=0;g<c.length;g++){d.trigger("ketchup."+c[g]);}},extractValidations:function(h,p){var j=h.substr(h.indexOf(p)+p.length+1),u="",m=[],r=0,g=[];for(var k=0;
k<j.length;k++){switch(j.charAt(k)){case"(":u+="(";r++;break;case")":if(r){u+=")";r--;}else{m.push(b.trim(u));}break;case",":if(r){u+=",";}else{m.push(b.trim(u));
u="";}break;default:u+=j.charAt(k);break;}}for(v=0;v<m.length;v++){var d=m[v].indexOf("("),q=m[v],l=[];if(d!=-1){q=b.trim(m[v].substr(0,d));l=b.map(m[v].substr(q.length).split(","),function(w){return b.trim(w.replace("(","").replace(")",""));
});}var c=this.validations[q];if(c&&c.message){var t=c.message;for(a=1;a<=l.length;a++){t=t.replace("{arg"+a+"}",l[a-1]);}g.push({name:q,arguments:l,func:c.func,message:t,init:c.init});
}}return g;},extractEvents:function(d,c){var g=false,h=d.indexOf(c+"(");if(h!=-1){g=d.substr(h+c.length+1).split(")")[0];}return g;},normalizeArray:function(d){var c=[];
for(i=0;i<d.length;i++){for(e=0;e<d[i].length;e++){if(d[i][e]){c.push(d[i][e]);}}}return c;},createErrorContainer:function(d,c){if(typeof d=="function"){this.defaults.createErrorContainer=d;
return this;}else{var g=c.offset();return b("<div/>",{html:"<ul></ul><span></span>","class":"ketchup-error",css:{top:g.top,left:g.left+c.outerWidth()-20}}).appendTo("body");
}},showErrorContainer:function(g,d,c){if(typeof g=="function"){this.defaults.showErrorContainer=g;return this;}else{c.show().animate({top:d.offset().top-c.height(),opacity:1},"fast");
}},hideErrorContainer:function(g,d,c){if(typeof g=="function"){this.defaults.hideErrorContainer=g;return this;}else{c.animate({top:d.offset().top,opacity:0},"fast",function(){c.hide();
});}},addErrorMessages:function(h,d,c,g){if(typeof h=="function"){this.defaults.addErrorMessages=h;return this;}else{var j=c.children("ul");j.html("");
for(i=0;i<g.length;i++){b("<li/>",{text:g[i]}).appendTo(j);}}}};b.fn.ketchup=function(d,c){var g=b(this);if(typeof d=="string"){switch(d){case"validate":b.ketchup.triggerValidationEvents(g);
break;case"isValid":return b.ketchup.elementIsValid(g);break;}}else{this.each(function(){b.ketchup.init(g,b.extend({},b.ketchup.defaults,d),c);});}return this;
};})(jQuery);